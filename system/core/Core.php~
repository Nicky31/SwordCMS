<?php

class Core {

    protected $arkalys;
    
   public function auto_load($name)
    {          
            if(file_exists(APP_PATH.'helpers/'. $name .'.php'))
                    require_once APP_PATH.'helpers/'. $name .'.php';
            elseif(file_exists(SYS_PATH.'helpers/'. $name .'.php'))
                    require_once SYS_PATH.'helpers/'. $name .'.php';	
            else
                    throw new Exception('Class file <b>'. APP_PATH .'helpers/'. $name .'.php</b> untraceable');
    }
    
    public static function exception_handler($exception)
     {
       $trace = '';
       foreach($exception->getTrace() as $k => $v)
       if(!empty($v['line']) AND !empty($v['file']))
       $trace .= '<strong>Ligne : </strong>' . $v['line'] . ' <strong>du fichier : </strong> ' . $v['file'] . '<br />';
       
       exit('<html lang="fr"><head><meta charset="utf-8" /> <title>Exception survenue</title > </head>
       <div style="background-color: #F6DDDD; border: 1px solid #FD1717; color: #8C2E0B; padding: 10px;">
       <h4>Une exception est survenue</h4>
       <strong>Message : </strong>' . $exception->getMessage() . '<br /><br />
       <strong>Ligne : </strong>' . $exception->getLine() . ' <strong>du fichier : </strong> ' . $exception->getFile() . '<br /><br />
       <strong>Appel : </strong><br /><pre>'
       . $trace .
       '</pre></div>
       </html>');
       
       }

    public function run()
    {
            require_once SYS_PATH.'core/Arkalys.php';
            require_once SYS_PATH.'core/url.php';
            require_once SYS_PATH.'core/model.php';
            require_once SYS_PATH.'core/Output.php';
            require_once SYS_PATH.'core/Controller.php';
            $url = new Url;
            $this->arkalys = new Arkalys;
            
     set_exception_handler(array('Core','exception_handler')); // Gestion des exceptions
     spl_autoload_register(array('Core','auto_load')); // Load auto des helpers
     $this->arkalys->run($url());
    }
   
}

?>
